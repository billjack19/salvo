!function(e){e.fn.maskMoney=function(t){return t=e.extend({symbol:"US$",showSymbol:!1,symbolStay:!1,thousands:",",decimal:".",precision:2,defaultZero:!0,allowZero:!1,allowNegative:!1},t),this.each(function(){function n(){d=!0}function a(){d=!1}function r(t){t=t||window.event;var r=t.charCode||t.keyCode||t.which;if(void 0==r)return!1;if(m.attr("readonly")&&13!=r&&9!=r)return!1;if(r<48||r>57)return 45==r?(n(),m.val(f(m)),!1):43==r?(n(),m.val(m.val().replace("-","")),!1):13==r||9==r?(d&&(a(),e(this).change()),!0):37==r||39==r||(s(t),!0);if(m.val().length>=m.attr("maxlength"))return!1;s(t);var l=String.fromCharCode(r),o=m.get(0),i=m.getInputSelection(o),c=i.start,v=i.end;return o.value=o.value.substring(0,c)+l+o.value.substring(v,o.value.length),u(o,c+1),n(),!1}function l(t){t=t||window.event;var r=t.charCode||t.keyCode||t.which;if(void 0==r)return!1;if(m.attr("readonly")&&13!=r&&9!=r)return!1;var l=m.get(0),o=m.getInputSelection(l),i=o.start,c=o.end;return 8==r?(s(t),i==c?(l.value=l.value.substring(0,i-1)+l.value.substring(c,l.value.length),i-=1):l.value=l.value.substring(0,i)+l.value.substring(c,l.value.length),u(l,i),n(),!1):9==r?(d&&(e(this).change(),a()),!0):46!=r&&63272!=r||(s(t),l.selectionStart==l.selectionEnd?l.value=l.value.substring(0,i)+l.value.substring(c+1,l.value.length):l.value=l.value.substring(0,i)+l.value.substring(c,l.value.length),u(l,i),n(),!1)}function o(e){var n=h();if(m.val()==n?m.val(""):""==m.val()&&t.defaultZero?m.val(g(n)):m.val(g(m.val())),this.createTextRange){var a=this.createTextRange();a.collapse(!1),a.select()}}function i(n){e.browser.msie&&r(n),""==m.val()||m.val()==g(h())||m.val()==t.symbol?t.allowZero?t.symbolStay?m.val(g(h())):m.val(h()):m.val(""):t.symbolStay?t.symbolStay&&m.val()==t.symbol&&m.val(g(h())):m.val(m.val().replace(t.symbol,""))}function s(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function u(e,t){var n=m.val().length;m.val(c(e.value));var a=m.val().length;t-=n-a,m.setCursorPosition(t)}function c(e){e=e.replace(t.symbol,"");var n="0123456789",a=e.length,r="",l="",o="";if(0!=a&&"-"==e.charAt(0)&&(e=e.replace("-",""),t.allowNegative&&(o="-")),0==a){if(!t.defaultZero)return l;l="0.00"}for(var i=0;i<a&&("0"==e.charAt(i)||e.charAt(i)==t.decimal);i++);for(;i<a;i++)n.indexOf(e.charAt(i))!=-1&&(r+=e.charAt(i));var s=parseFloat(r);s=isNaN(s)?0:s/Math.pow(10,t.precision),l=s.toFixed(t.precision),i=0==t.precision?0:1;var u,c=(l=l.split("."))[i].substr(0,t.precision);for(u=(l=l[0]).length;(u-=3)>=1;)l=l.substr(0,u)+t.thousands+l.substr(u);return g(t.precision>0?o+l+t.decimal+c+Array(t.precision+1-c.length).join(0):o+l)}function v(){var e=m.val();m.val(c(e))}function h(){var e=parseFloat("0")/Math.pow(10,t.precision);return e.toFixed(t.precision).replace(new RegExp("\\.","g"),t.decimal)}function g(e){return t.showSymbol&&e.substr(0,t.symbol.length)!=t.symbol?t.symbol+e:e}function f(e){if(t.allowNegative){e.val();return""!=e.val()&&"-"==e.val().charAt(0)?e.val().replace("-",""):"-"+e.val()}return e.val()}var m=e(this),d=!1;m.bind("keypress.maskMoney",r),m.bind("keydown.maskMoney",l),m.bind("blur.maskMoney",i),m.bind("focus.maskMoney",o),m.bind("maskAppend",v),m.one("unmaskMoney",function(){m.unbind(".maskMoney"),e.browser.msie?this.onpaste=null:e.browser.mozilla&&this.removeEventListener("input",i,!1)})})},e.fn.unmaskMoney=function(){return this.trigger("unmaskMoney")},e.fn.maskAppend=function(){return this.trigger("maskAppend")},e.fn.setCursorPosition=function(e){return this.each(function(t,n){if(n.setSelectionRange)n.focus(),n.setSelectionRange(e,e);else if(n.createTextRange){var a=n.createTextRange();a.collapse(!0),a.moveEnd("character",e),a.moveStart("character",e),a.select()}}),this},e.fn.getInputSelection=function(e){var t,n,a,r,l,o=0,i=0;return"number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd?(o=e.selectionStart,i=e.selectionEnd):(n=document.selection.createRange(),n&&n.parentElement()==e&&(r=e.value.length,t=e.value.replace(/\r\n/g,"\n"),a=e.createTextRange(),a.moveToBookmark(n.getBookmark()),l=e.createTextRange(),l.collapse(!1),a.compareEndPoints("StartToEnd",l)>-1?o=i=r:(o=-a.moveStart("character",-r),o+=t.slice(0,o).split("\n").length-1,a.compareEndPoints("EndToEnd",l)>-1?i=r:(i=-a.moveEnd("character",-r),i+=t.slice(0,i).split("\n").length-1)))),{start:o,end:i}}}(jQuery);