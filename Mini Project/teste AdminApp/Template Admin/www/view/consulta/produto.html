<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Orçamento - CDI</title>
	<link rel='shortcut icon' href="../../dist/img/icone.ico" />
	<!-- Tell the browser to be responsive to screen width -->
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<!-- Bootstrap 3.3.7 -->
	<link rel="stylesheet" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="../../bower_components/font-awesome/css/font-awesome.min.css">


	<link href="../../lb/jquery-flexdatalist/jquery.flexdatalist.min.css" rel="stylesheet" type="text/css">

	<!-- Ionicons -->
	<link rel="stylesheet" href="../../bower_components/Ionicons/css/ionicons.min.css">
	<!-- DataTables -->
	<link rel="stylesheet" href="../../bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
	<!-- Theme style -->
	<link rel="stylesheet" href="../../dist/css/AdminLTE.min.css">
	<!-- AdminLTE Skins. Choose a skin from the css/skins
			 folder instead of downloading all of them to reduce the load. -->
	<link rel="stylesheet" href="../../dist/css/skins/_all-skins.min.css">
	<!-- Morris chart -->
	<link rel="stylesheet" href="../../bower_components/morris.js/morris.css">
	<!-- jvectormap -->
	<link rel="stylesheet" href="../../bower_components/jvectormap/jquery-jvectormap.css">
	<!-- Date Picker -->
	<link rel="stylesheet" href="../../bower_components/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
	<!-- Daterange picker -->
	<link rel="stylesheet" href="../../bower_components/bootstrap-daterangepicker/daterangepicker.css">
	<!-- bootstrap wysihtml5 - text editor -->
	<link rel="stylesheet" href="../../plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->

	<!-- Google Font -->
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">

</head>
<!-- <body class="hold-transition skin-blue sidebar-mini"> -->
<body class="hold-transition skin-blue fixed sidebar-mini">

<div class="wrapper" id='conteudoGeral'>


<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
	<!-- Content Header (Page header) -->
	<section class="content-header">
		<h1 id='tituloPagina'>
			Orçamento Web CDI
			<small>Painel de Controle</small>
		</h1>
		<ol class="breadcrumb">
			<li><a href="../../principal.html"><i class="fa fa-history"></i> Pagina Principal</a></li>
			<li class="active">Consutar Produto</li>
		</ol>
	</section>

	<section class="content">
		<div class="box">

			<div class="box-header with-border">
				<h3 class="box-title">Consutar Produto</h3>

				<div class="box-tools pull-right">
					
					<button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Minimizar">
						<i class="fa fa-minus"></i>
					</button>
				</div>
			</div>

			<div class="box-body">


<fieldset class="muted">
	<!-- <legend>
		<h4 class="text-primary">
		<i class="fa fa-list margin-right-5px"></i>&nbsp;&nbsp;&nbsp;Produtos</h4>
	</legend> -->


	<div class="form-group col-xs-5 col-sm-3 col-lg-3 col-md-3">
		<label>Codigo</label>
		<input type='tel' class='form-control' id='codigoItem' onkeyup="mudarItem(this.value)">
	</div>

	<div class="form-group col-xs-7 col-sm-9 col-lg-9 col-md-9">
		<label>Item</label>
		<div id='itemComboDatalist'>
			<input type="text" value="Carregando..." disabled class="form-control">
		</div>
	</div>

	<br><br><br><br>
	<div class="col-sm-6 col-lg-6 col-md-6" >
		<label>Quantidade</label>
		<table>
			<tr>
				<td width='50%'>
					<input type='tel' style='text-align: right;' class='form-control' id='qdtItem' value='1' onkeyup='selecionarUnidade()' onfocus='setarItemSeleconado()'>
				</td>
				<td width='25%'>
					<button class='btn btn-block' onclick='mudarQdtItem("+")'>
						<i class='fa fa-plus'></i>
					</button>
				</td>
				<td width='25%'>
					<button class='btn btn-block' onclick='mudarQdtItem("-")'>
						<i class='fa fa-minus'></i>
					</button>
				</td>
			</tr>
		</table>
	</div>

	<div class="form-group col-sm-6 col-lg-6 col-md-6">
		<label>Unidade de Mendida</label>
		<div id='divSelectUnidade'>
			<input type="text" class="form-control" value="Nenhum item selecionado" disabled>
		</div>
	</div>

	<div class="form-group col-sm-4 col-lg-4 col-md-4">
		<label>Quantidade Principal</label>
		<input type='text' style='text-align: right;' class='form-control' id='qtdPrincipal' value='1' disabled>
	</div>

	<div class="form-group col-sm-4 col-lg-4 col-md-4">
		<label>Valor Unitario</label>
		<input type='text' style='text-align: right;' class='form-control' id='vlrVenda' onkeyup='selecionarUnidade()'>
	</div>

	<div class="form-group col-sm-4 col-lg-4 col-md-4">
		<label>Valor Total</label>
		<input type='text' style='text-align: right;' class='form-control' id='vlrTotal' disabled>
	</div>


	<div class="form-group col-sm-4 col-lg-4 col-md-4">
		<label>Estoque</label>
		<input type='text' style='text-align: right;' class='form-control' id='estoqueProduto' disabled>
	</div>

</fieldset>

			</div>
		</div>
	</section>

</div>





<footer class="main-footer fixed">
	<div class="pull-right hidden-xs">
		<b>Version</b> 1.0
	</div>
	<strong>
		Desenvolvido por <a href="http://cdiinfo.com.br/" target="_blank"> CDI Informática e Contabilidade</a>.
	</strong>
</footer>














<!-- Control Sidebar -->
<aside class="control-sidebar control-sidebar-dark" id='conteudoMenuGear'>
</aside>
<script type="text/javascript" src="../../componetes/conteudoMenuGear.js"></script>
<!-- /.control-sidebar -->












	<!-- Add the sidebar's background. This div must be placed
			 immediately after the control sidebar -->
	<div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->
<script type="text/javascript">
	var prefixoCaminho = "../../";

	var usuario_Global = "";
	var empresa_Global = "";

	if (localStorage.empresa_Global && localStorage.usuario_Global) {
		usuario_Global = JSON.parse(localStorage.getItem("usuario_Global"));
		empresa_Global = JSON.parse(localStorage.getItem("empresa_Global")); 
	} else {
		alert("Você não logado para acessar o sistema!");
		window.location.assing(prefixoCaminho + "index.html");
	}
</script>
<script type="text/javascript" src="../../componetes/menu.js"></script>

<script type="text/javascript">
	/* if (localStorage.empresa_Global && localStorage.usuario_Global) { */
	/* 	empresa_Global = JSON.parse(localStorage.getItem("empresa_Global")); */
	/* 	usuario_Global = JSON.parse(localStorage.getItem("usuario_Global")); */

	/* console.log(empresa_Global); */
	/* console.log(usuario_Global); */

	var especificaoesUsuario = usuario_Global.nome  /* + " - Vendedor" */
							 + "<small>" + empresa_Global.RAZAOSOCIAL + "</small>";
	
	document.getElementById("usuarioLogado").innerHTML = usuario_Global.nome;
	document.getElementById("usuarioLogado2").innerHTML = usuario_Global.nome;

	document.getElementById("especificaoesUsuario").innerHTML = especificaoesUsuario;
	/* } else { */
	/* 	alert("Você não logado para acessar o sistema!"); */
	/* 	window.location.assing(prefixoCaminho + "index.html"); */
	/* } */


	try{
		if (empresa_Global.WEB_NOME_REDUZIDO != "") {
			document.getElementById("setarNomeEmpresa").innerHTML = empresa_Global.WEB_NOME_REDUZIDO;
		} else {
			document.getElementById("setarNomeEmpresa").innerHTML = empresa_Global.RAZAOSOCIAL.split(" ")[0];
		}
	}catch(error){
		document.getElementById("setarNomeEmpresa").innerHTML = empresa_Global.RAZAOSOCIAL.split(" ")[0];
	}
</script>



<!-- jQuery 3 -->
<script src="../../bower_components/jquery/dist/jquery.min.js"></script>
<!-- jQuery UI 1.11.4 -->
<script src="../../bower_components/jquery-ui/jquery-ui.min.js"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
	$.widget.bridge('uibutton', $.ui.button);
</script>
<!-- Bootstrap 3.3.7 -->
<script src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- Select2 -->
<!-- <script src="../../bower_components/select2/dist/js/select2.full.min.js"></script> -->

<script src="../../lb/jquery-flexdatalist/jquery.flexdatalist.min.js"></script>

<!-- InputMask -->
<script src="../../plugins/input-mask/jquery.inputmask.js"></script>
<script src="../../plugins/input-mask/jquery.inputmask.date.extensions.js"></script>
<script src="../../plugins/input-mask/jquery.inputmask.extensions.js"></script>
<!-- Morris.js charts -->
<script src="../../bower_components/raphael/raphael.min.js"></script>
<script src="../../bower_components/morris.js/morris.min.js"></script>
<!-- Sparkline -->
<script src="../../bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
<!-- jvectormap -->
<script src="../../plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script src="../../plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<!-- jQuery Knob Chart -->
<script src="../../bower_components/jquery-knob/dist/jquery.knob.min.js"></script>
<!-- daterangepicker -->
<script src="../../bower_components/moment/min/moment.min.js"></script>
<script src="../../bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
<!-- datepicker -->
<script src="../../bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
<!-- Bootstrap WYSIHTML5 -->
<script src="../../plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<!-- DataTables -->
<script src="../../bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../../bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
<!-- Slimscroll -->
<script src="../../bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="../../bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../../dist/js/adminlte.min.js"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="../../dist/js/pages/dashboard.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../../dist/js/demo.js"></script>

<script type="text/javascript" src="../../js/scripts.js"></script>


<script>
/* Configurações iniciais */
if (!localStorage.usuario_Global) {
	window.location.assign(prefixoCaminho + "index.html");
}



/*  Variaveis Globais  */
var pedido_Global = "";
var pedido_item_Global = "";
var pedido_edit_Global = "";
var indicePedido_Global = 0;
var clientes_list_Global = "";
var cliente_Global = "";
var item_list_Global = "";
var item_Global = "";
var preco_minimo_Global = true;
var statusPedido_Gloabal = "";
var ultimaPaginaGlobal = "conteudoPedido";

var parametroCodigoDinheiro_Global = 5;


$('[data-mask]').inputmask();
$("#dataEmissaoPedido").val(pegarData());








/********************************************************************************************************************/
/********************************************************************************************************************/
/********************************************************************************************************************/
/********************************************************************************************************************/
/********************************************************************************************************************/
/* Inicio funcoes de Itens */
/********************************************************************************************************************/
/********************************************************************************************************************/
/********************************************************************************************************************/
/********************************************************************************************************************/
motarComboListItem('itemComboDatalist');

function motarComboListItem(idDiv){
	$.ajax({
		url: caminhoServer+"item.php",
		type: 'POST',
		dataType: 'text',
		data:{
			'listarSoItem': true,
			'filial': usuario_Global.filial,
			'codigo_empresa': empresa_Global.CODIGO
		}
	}).done( function(dataItem){
		item_list_Global = JSON.parse(dataItem);

		var montarInputList = "";

		if (item_list_Global.length == 0) {
			montarInputList += "<input type='text' class='form-control' id='itemCombo_Global' placeholder='Sem registros (Cliente)' disabled>";
		} else {
			montarInputList += "<input type='text' id='itemCombo_Global'";
			montarInputList += "class='flexdatalist form-control' placeholder='Cliente'";
			montarInputList += "data-min-length='0' data-visible-properties='[\"descricao\"]' ";
			montarInputList += "data-selection-required='true' data-value-property='item' ";
			montarInputList += "onchange='mudarItem(this.value)' onfocus='limparValorCombo(this.id)'";
			montarInputList += "required disabled>";
		}

		$("#"+idDiv).html(montarInputList);
		setarValorCombo(item_list_Global,'itemCombo_Global','item','descricao','i',0,"");
	});
}




function setarValorCombo(eljson, id, value, descricao, accessKey, idValor, DescricaoValor){
	$('#'+id+'').flexdatalist({
		selectionRequired: true,
		valueProperty: value,
		searchIn: descricao,
		minLength: 0,
		data: eljson
	});
	document.getElementById( id + "-flexdatalist").disabled = false;
	document.getElementById( id + "-flexdatalist").accessKey = accessKey;

	if (idValor != 0 && DescricaoValor != "") {
		document.getElementById( id ).value = idValor;
		document.getElementById( id + "-flexdatalist" ).value = DescricaoValor;
	}
}



function mudarItem(item){
	if (jk_validaCampo(item, "", "")) {
		$.ajax({
			url: caminhoServer+"item.php",
			type: 'POST',
			dataType: 'text',
			data:{
				'listarItemId': true,
				'id': item,
				'filial': usuario_Global.filial,
				'codigo_empresa': empresa_Global.CODIGO
			},
			error: function(){ /* Caso der erro */	}
		}).done( function(data){
			 /* console.log(data); */
			if(jk_validaCampo(data.substring(2, data.length).replace("}", ""), "", "")){
				item_Global = JSON.parse(data);
				/* console.log(item_Global); */

				var select_unidade = "";
				var selecionado = "";
				select_unidade += "<select id='selectUnidadeMedid' class='form-control' onchange='selecionarUnidade()'>";
				for (var i = 0; i < item_Global.unidade_medida.length; i++) {

					selecionado = item_Global.unidade_medida[i].unidade_medida == item_Global.unidade_medida_venda ? " selected" : "";

					select_unidade += 	"<option value='"+i+"'"+selecionado+">";
					select_unidade += 		item_Global.unidade_medida[i].descricao_unidade + " - " + item_Global.unidade_medida[i].unidade_medida;
					select_unidade += 	"</option>";
				}
				select_unidade += "</select><br>";

				$("#divSelectUnidade").html(select_unidade);
				$("#codigoItem").val(item);
				$("#itemCombo_Global").val(item);
				$("#select2-itemCombo_Global-container").val(item.descricao);
				$("#itemCombo_Global-flexdatalist").val(item_Global.descricao);
				$("#vlrVenda").val(formataValorParaImprimir(item_Global.preco_medio));
				$("#estoqueProduto").val(item_Global.estoque);

				selecionarUnidade();
			} else $("#codigoItem").val(item_Global.codigo);
		});
	}
}



function selecionarUnidade(){
	/* console.log("selecionarUnidade"); */
	var indice = $("#selectUnidadeMedid").val();
	var quantidade = item_Global.unidade_medida[indice].quantidade;
	var unidade_medida = item_Global.unidade_medida[indice].unidade_medida;
	var preco_medio = item_Global.preco_medio;
	var vlrVenda = formataValorParaCalcular2($("#vlrVenda").val());
	var preco_minimo = item_Global.preco_minimo;

	/* console.log("vlrVenda: "+vlrVenda+"\npreco_minimo: "+preco_minimo); */
	/* console.log(item_Global); */

	if (vlrVenda < preco_minimo) 	preco_minimo_Global = false;
	else 							preco_minimo_Global = true;

	try { 
		$("#qtdPrincipal").val( formatarValorParaDecimal(parseFloat(quantidade) * Number($("#qdtItem").val())) );
	} catch(erro){
		alert("A qunatidade do imtem está incorreta!");
	}
	calcularTotal();
}


function calcularTotal(){
	var quantidadePrincipal = formataValorParaCalcular2($("#qtdPrincipal").val());
	var vlrVenda = formataValorParaCalcular2($("#vlrVenda").val());
	var valorTotal = parseFloat(quantidadePrincipal) * parseFloat(vlrVenda); /* parseFloat(qunatidade) * */
	
	$("#vlrTotal").val(formataValorParaImprimir(valorTotal));
}



function mudarQdtItem(operacao){
	var quantidade = $("#qdtItem").val();
	quantidade = parseFloat(quantidade);

		 if (operacao == "-") {if(quantidade > 1) 	quantidade--;}
	else if (operacao == '+') 						quantidade++;
	else 											quantidade = operacao;

	$("#qdtItem").val(quantidade);
	$("#qtdPrincipal").val( 
		formatarValorParaDecimal(
			Number(item_Global.unidade_medida[$("#selectUnidadeMedid").val()].quantidade) * Number($("#qdtItem").val())
		)
	);
	calcularTotal();
}

/********************************************************************************************************************/
/********************************************************************************************************************/
/********************************************************************************************************************/
/********************************************************************************************************************/
/********************************************************************************************************************/
/* Fim funcoes de Itens */
/********************************************************************************************************************/
/********************************************************************************************************************/
/********************************************************************************************************************/
/********************************************************************************************************************/




/* Funções prontas só copiar */
function jk_validaCampo(campo, mensagemSuccess, mensagemErro){
	var tipo = typeof(campo);
	var retorno = false;
	if (tipo == "string") {
		if (campo == "0" || campo == "") {
			if (mensagemErro != "") alert(mensagemErro);
			/* console.log(mensagemErro); */
			retorno = false;
		} else {
			if (mensagemSuccess != "") alert(mensagemSuccess);
			retorno = true;
		}
	} else if (tipo == "number") {
		if (campo == 0) {
			if (mensagemErro != "") alert(mensagemErro);
			retorno = false;
		} else {
			if (mensagemSuccess != "") alert(mensagemSuccess);
			retorno = true;
		}
	}

	return retorno;
}


</script>

<style type="text/css">
	.descricaoSituacao{ padding: 5px; border-radius: 5px; }
</style>
</body>
</html>