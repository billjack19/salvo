<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<link rel='shortcut icon' href="img/icon.png" />
	<meta name="format-detection" content="telephone=no" />
	<meta name="msapplication-tap-highlight" content="no" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
	<meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' gap:; style-src 'self' 'unsafe-inline'; media-src *" />

	<title>Compras</title>
	<!-- <link rel="stylesheet" type="text/css" href="css/index.css" /> -->

	<script type="text/javascript" src="js/jQuery.js"></script>

	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="css/estilo.css">
	<link rel="stylesheet" type="text/css" href="css/font-awesome/css/font-awesome.min.css">      

	
	<!-- Scrips padrão -->
	<script type="text/javascript" src="js/scripts.js"></script>
	<script type="text/javascript" src="js/valorPorExtenco.js"></script>
	<script type="text/javascript" src="js/bootstrap.js"></script>

	<script type="text/javascript" src="js/bootbox.js"></script>
	<script type="text/javascript" src="js/masked2.js"></script>
	<script type="text/javascript" src="js/masked.js"></script>
	<script type="text/javascript" src="js/toast.js"></script>
	<script type="text/javascript" src="js/maskmoney.js"></script>
	<script type="text/javascript" src="js/moment.js"></script>

	<!-- Biblioteca dataList usando Jquery  -->
	<link href="lb/jquery-flexdatalist/jquery.flexdatalist.min.css" rel="stylesheet" type="text/css">
	<script src="lb/jquery-flexdatalist/jquery.flexdatalist.min.js"></script>

	<script src="js/jquery.maskMoney.min.js" type="text/javascript"></script>

	<link rel="stylesheet" type="text/css" href="css/toast.css">

	<script type="text/javascript">
		// if(!localStorage.IP) 
		localStorage.setItem("IP", "192.168.1.102");
		var ip_Global = "http://" + localStorage.getItem("IP") + "/compras/comprasWeb/";
		alert(ip_Global);
		console.log(ip_Global);
		if (localStorage.usuario_Global) window.location.assign("principal.html");
	</script>
</head>

<body>
	<div class="">
		<h1>Login</h1>
		<label>Login</label>
		<input type="text" id="usuario" class="form-control">
		<label>Senha</label>
		<input type="password" id="senha" class="form-control">
		<br>
		<button class="btn btn-block btn-primary" onclick="logarSistema()">
			Entrar
		</button>
	</div>
	<!-- <script type="text/javascript" src="cordova.js"></script> -->
	<!-- <script type="text/javascript" src="js/index.js"></script> -->
	<script type="text/javascript">
		// app.initialize();
	</script>


	<script type="text/javascript">
		function ping(){
			$.ajax({
				url: ip_Global + "controllers/ping.php",
				type: 'GET',
				dataType: "text",
				error: function(){
					alert("Sem conexão com o servidor!");
				}
			}).done( function(data){
				if (data == "1") {
					alert("Você está conectado!");
				} else {
					alert("Falha na conexão com servidor!");
				}
			});
		}
		ping();

		function logarSistema(){
			var usuario = $("#usuario").val().replace(/\"/g, "");
			var senha = $("#senha").val().replace(/\"/g, "");

			if (usuario != "" && senha != "") {
				console.log(ip_Global + "controllers/login.php");
				$.ajax({
					url: ip_Global + "controllers/login.php",
					type: "POST",
					dataType: "text",
					data: {
						'login': usuario,
						'senha': senha
					},
					error: function(){ alert("Falha na conexao! Verifique seu acesso com a Internet"); }
				}).done( function(data){
					console.log(data);
					try{
						var dataObj = JSON.parse(data);
						if (dataObj.debug == "OK") {
							localStorage.setItem("usuario_Global", data);
							window.location.assign("principal.html");
						} else {
							alert(dataObj.debug);
						}
					}catch(errro){
						alert("Falha ao tenatar fazer conveeção para objeto JSON: " + error);
					}
				});
			} else {
				alert("Preencha os dados do formulario corretamente!");
			}
		}
	</script>
</body>

</html>
