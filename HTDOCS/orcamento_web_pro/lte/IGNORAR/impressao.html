<!DOCTYPE html>
<html>
<head>
	<title>Impressão Orçamento</title>
	<meta charset="utf-8">
</head>
<body>

	<table width="100%">
		<tr>
			<td width="50%">
				<table width="100%" style="border-style: solid;">
					<tr>
						<td align="center" width="100%">
							<img src="" id="imagemLogo" width="20%">
						</td>
					</tr>
					<tr align="center">
						<td>Endereço: tetsetesatrgdf</td>
					</tr>
				</table>
			</td>
			<td width="50%">
				<table width="100%" border="1">
					<tr>
						<td width="100%">
							<h2>Orçamento: <span id="numDocumento"></span></h2>
						</td>
					<tr>
					</tr>
						<td>
							<h2>Emissão: <span id="emissao"></span></h2>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<table width="100%">
		<tr>
			<td width="50%">
				<table width="100%">
					<tr>
						<td colspan='2' style="border-bottom-style: solid;">
							<h2 style="margin: 0">Dados do Cliente</h2>
						</td>
					</tr>
					<tr>
						<td width="100px;"><b>Nome:</b></td>
						<td id="nomeCliente">Teste</td>
					</tr>
					<tr>
						<td width="100px;"><b>Telefone: </b></td>
						<td id="telefoneCliente">(86) 9789-7897</td>
					</tr>
					<tr>
						<td width="100px;"><b>Contato:</b></td>
						<td id="contatoCliente">Teste</td>
					</tr>
				</table>
			</td>
			<td width="50%">
				<table width="100%">
					<tr>
						<td colspan="2" style="border-bottom-style: solid;">
							<h2 style="margin: 0">Local de Entrega</h2>
						</td>
					</tr>
					<tr>
						<td width="100px;"><b>Enderecço</b></td>
						<td id="endereco">Teste</td>
					</tr>
					<tr>
						<td width="100px;"><b>Bairro</b></td>
						<td id="bairro">Teste</td>
					</tr>
					<tr>
						<td width="100px;"><b>Cidade - UF</b></td>
						<td id="cidadeEstado">Teste AB</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>


	<h2 style='margin-bottom: 0;border-bottom-style: solid;'>Produtos</h2>
	<div id='contudoProduto'>
		<table width="100%">
			<tr>
				<td><b>Descrição</b></td>
				<td><b>Quantidade</b></td>
				<td><b>Valor Unitario</b></td>
				<td><b>Valor Total</b></td>
			</tr>

			<tr>
				<td>0 - Teste</td>
				<td>123 - KG</td>
				<td>R$ 4,50</td>
				<td>R$ 553,50</td>
			</tr>

			<tr>
				<td align="right" style="border-top-style: solid;" colspan="3"><b>Total: </b></td>
				<td style="border-top-style: solid;">R$ 553,50</td>
			</tr>
		</table>
	</div>



	<h2 style="margin-bottom: 0;border-bottom-style: solid;">Codições Gerais</h2>
	<table width="100%">
		<tr>
			<td><b>Forma de Pagamento: </b></td>
			<td id="formaPagamento">Dinheiro</td>
		</tr>
		<tr>
			<td id="observacoa"><b>Observações: </b></td>
			<td></td>
		</tr>

	</table>


	<script type="text/javascript">
		if (!localStorage.orcamentoSelecionado) {
			alert("Não tem acesso para este conteudo!");
			window.close();
		}

		var empresa_Global = JSON.parse( localStorage.getItem("empresa_Global")			);
		var usuario_Global = JSON.parse( localStorage.getItem("usuario_Global")			);
		var pedido_Global  = JOSN.parse( localStorage.getItem("orcamentoSelecionado")	);
		var dadosEmpresa = "";
		var pedido_item_Global = "";
		var caminhoServer = "http://cdiinfo.com.br/aplicacoes_web/orcamento/controllers/";
		var imagemLogo = "http://cdiinfo.com.br/aplicacoes_web/logo/"				// Caminho absoluto
					   + empresa_Global.RAZAOSOCIAL.replace(/\./gi, "") + "/" 		// Nome da Empresa
					   + usuario_Global.filial + ".jpg";							// Nome da imagem

		document.getElementById("imagemLogo").src = imagemLogo;
		selecionarPedido();



		function selecionarPedido(){
			$.ajax({
				url: caminhoServer+"impressao.php",
				type: "POST",
				dataType: "text",
				data: {
					'consultaEmpresa': true,
					'codigo_empresa': empresa_Global.CODIGO,
					'filial': usuario_Global.filial
				},
				error: function(){
					console.log("Erro na requisição");
				}
			}).done( function(data){
				console.log(data);
				data = JOSN.parse(data);
				console.log(data);


				var descricaoEndereco = "";

				$.ajax({
					url: caminhoServer+"pedido_item.php",
					type: 'POST',
					dataType: 'text',
					data:{
						'listaPedidoItem': true,
						'filial': usuario_Global.filial,
						'documento': pedido_Global.documento,
						'codigo_empresa': empresa_Global.CODIGO
					}
				}).done( function(data){
					/* console.log(data); */
					pedido_item_Global = JSON.parse(data);
					console.log(pedido_item_Global);

					visualizarPedido();
				});
			});
		}




		function visualizarPedido(){
			var numeroEnderecoUnico = pedido_Global.numero != "" ?  " - " + pedido_Global.numero : "";
			var estadoEnderecoUnico = pedido_Global.estado != "" ?  " - " + pedido_Global.estado : "";

			var arrayPagamento = pedido_Global.pagamento.split(" ");
			var pagamento = "";
			if ( !isNaN(arrayPagamento[0]) ){for(var i = 1; i < arrayPagamento.length; i++) pagamento += arrayPagamento[i];} 
			else 																			pagamento = pedido_Global.pagamento;

			document.getElementById("numDocumento").innerHTML = pedido_Global.documento;
			document.getElementById("emissao").innerHTML = 
			document.getElementById("nomeCliente").innerHTML = 
			document.getElementById("telefoneCliente").innerHTML = 
			document.getElementById("contatoCliente").innerHTML = 
			document.getElementById("endereco").innerHTML = pedido_Global.endereco + numeroEnderecoUnico;
			document.getElementById("bairro").innerHTML = pedido_Global.bairro;
			document.getElementById("cidadeEstado").innerHTML = pedido_Global.cidade + estadoEnderecoUnico
			document.getElementById("formaPagamento").innerHTML = pagamento
			document.getElementById("observacoa").innerHTML = 

			document.getElementById("contudoProduto").innerHTML = montarTabelaItens();
			// $("#modalVisuPedido").modal("show");
		}


		function montarTabelaItens(){
			var conteudo = "";
			var valorTotal = 0;
			if (pedido_item_Global.length == 0) {
				conteudo += "<h3>Nenhum registro encontrado</h3>";
			} else {
				conteudo += 	"<table width='100%' class='fontTable2'>"
						 + 			"<tr>"
						 + 				"<td><b>Descrição</b></td>"
						 + 				"<td align='left' width='33%'>		<b>Qdt - U.M.</b>	</td>"
						 + 				"<td align='center' width='33%'>	<b>Vlr. Uni.</b>	</td>"
						 + 				"<td align='center' width='33%'>	<b>Vlr. Total</b>	</td>"
						 + 			"</tr>";

				for (var i = pedido_item_Global.length - 1; i >= 0; i--) {
					/* pedido_item_Global[i] */
					conteudo += 	"<tr id='linhaPedidoItem"+i+"' style='border-top-style:solid;'>"
							 + 			"<td>"
							 + 				pedido_item_Global[i].item.item + " - " + pedido_item_Global[i].item.descricao
							 + 			"</td>"
							 // + 		"</tr>"
							 // + 		"<tr id='linhaPedidoItem2"+i+"'>"
							 + 			"<td align='left' width='33%'>"
							 + 				pedido_item_Global[i].quantidade + " - " + pedido_item_Global[i].unidade
							 + 			"</td>"
							 + 			"<td align='center' width='33%'>"
							 + 				formataValorParaImprimir(pedido_item_Global[i].valor_unitario)
							 + 			"</td>"
							 + 			"<td align='center' width='33%'>"
							 + 				formataValorParaImprimir(pedido_item_Global[i].valor_total)
							 + 			"</td>"
							 + 		"</tr>";
					valorTotal += parseFloat(pedido_item_Global[i].valor_total);
				}
				conteudo + 			"<tr>"
						 + 				"<td align='right' colspan='3'><b>Total: </b></td>";
						 + 				"<td align='right'>"+formataValorParaImprimir(valorTotal)+"</td>";
						 + 			"</tr>";
						 + 		"</table>";
			}
			return conteudo;
		}
	</script>
</body>
</html>