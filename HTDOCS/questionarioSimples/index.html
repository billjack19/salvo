<html>
<head>
	<meta charset="utf-8">
	<script src="jQuery.js"></script>
</head>
<body>
	<center><h1>Formulario</h1></center>
	Nome: <input type="text" id="nome"><br>
	<div id="questionario"></div>

	<button onclick="enviar()">Enviar</button>
<script>
	/* var questionario = [
		{id: 1, pergunta: 'Pergunta 1', alternativas: [
			{alternativa: 'a', resposta: 'Alternativa A'},
			{alternativa: 'b', resposta: 'Alternativa B'}
		]},
		{id: 2,pergunta: 'Pergunta 2', alternativas: [
			{alternativa: 'a', resposta: 'Alternativa A'},
			{alternativa: 'b', resposta: 'Alternativa B'}
		]},
	]; */
	var questionario = "";
	function requisitarQuetionario(){
		$.ajax({
			url: "controllerQuestionario.php",
			type: 'POST',
			dataType: 'text',
			data: { 'listar': true },
			error: function(error){
				alert("Falha ao fazer a requisição com o servidor");
				document.getElementById("questionario").innerHTML = "Error ao motar questionario";
			}
		}).done( function(data){
			console.log(data);
			data = JSON.parse(data);
			console.log(data);
			questionario = data;
			criarQuestionario();
		});
	}

	function criarQuestionario(){
		var conteudo = "";
		for (var i = 0; i < questionario.length; i++) {
			conteudo += "<h3>" + questionario[i].pergunta + "</h3>"
					 + 	"<table width='100%' border='1px'>";
			var alternativas = questionario[i].alternativas;
			for (var j = 0; j < alternativas.length; j++) {
			conteudo += 
					 + 		"<tr>"
					 + 			"<td>"
					 + 				"<input type='text' name='perg"+i+"' value='"+alternativas[j].alternativa+"' id='perg"+i+"alt_"+alternativas[j].alternativa+"'>"
					 + 			"</td>"
					 + 			"<td>"+alternativas[j].resposta+"</td>"
					 + 		"</tr>"
			}
			conteudo += "</table>"
					 + 	"<br>";
		}
		document.getElementById("questionario").innerHTML = conteudo;
	}


	function enviar(){
		var perguntas;
		var resposta = "", repondido = false;
		for (var i = 0; i < questionario.length; i++) {
			var alternativas = document.getElementByName("perg"+i);
			repondido = false;
			for (var j = 0; j < alternativas.length; j++) {
				if(alternativas[j].checked){
					resposta += resposta = questionario[i].id + "," + alternativas[j].value; 
					repondido = true;
				}
			}
			perguntas += perguntas == "" ? resposta : "/" + resposta;
		}

		$.ajax({
			url: "controllerQuestionario.php",
			type: 'POST',
			dataType: 'text',
			data: {
				'gravar': true,
				'questionario': perguntas
			},
			error: function(error){
				alert("Falha ao fazer a requisição com o servidor");
			}
		}).done( function(data){
			console.log(data);
			alert("Questionario gravado com sucesso");
		});
	}
</script>
</body>
</html>