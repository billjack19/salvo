<!DOCTYPE html>
<html>
<head>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script> 
	<script src="http://malsup.github.com/jquery.form.js"></script>
</head>
<body>

<div class="container">
	<br>
	<!-- <h4 class="text-center">Importando arquivos</h4> -->
	<div class="container">
		<div class="progress">
			<div id="geral" class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100">
				<span class="sr-only"></span>
			</div>
		</div>
	</div>
	<!-- <div class="container">
		<div class="progress">
			<div id="atual" class="progress-bar progress-bar-success progress-bar-striped" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100">
				<span class="sr-only"></span>
			</div>
		</div>
	</div> -->
</div>




<script type="text/javascript">
	var progressBarGeral = $("#geral");
	
	progressBarGeral.width(50 + '%');

	// var progressBarAtual = $("#atual");

	$.ajax({
		type: 'POST', //Or 'GET',
		url: "http://localhost:8088/Gerador/views/BackupProjetoAcao.php",
		data: {
			"importarBanco": true,
			"pasta": "GeradorBackUp",
			"projeto_id": 16
		},
		xhr: function() {
			console.log("shr");
			var xhr = new window.XMLHttpRequest();
			// setInterval( function(){
				xhr.upload.addEventListener("progress", function(evt) {
					if (evt.lengthComputable) {
						var percentComplete = evt.loaded / evt.total;
						console.log("evt.loaded / evt.total: "+evt.loaded+"/"+evt.total);
						console.log(percentComplete);
						progressBarGeral.width(percentComplete + '%');

						// addProgress((percentComplete * 100) + '%');
					} else {
						console.log("! evt.lengthComputable");
					}
				}, false);
				xhr.addEventListener("progress", function(evt) {
					if (evt.lengthComputable) {
						var percentComplete = evt.loaded / evt.total;
						console.log(percentComplete);
						progressBarGeral.width(percentComplete + '%'); //  + '%'

						// addProgress((percentComplete * 100) + '%');
					} else {
						console.log("! evt.lengthComputable");
					}
				}, false);
				return xhr;
			// }, 500);
		},
		/*xhrFields: {
			onprogress: function (e){
				console.log("onprogress");
				var data = e.currentTarget.response;

				console.log(data);

				if (data.lastIndexOf('|') >= 0) {
					var val2 = data.slice((data.lastIndexOf('|') + 1));
					var val = val2.split("-");

					var numProgressGeral = parseFloat(val[1]);
					var numProgressAtual = parseFloat(val[0]);

					progressBarGeral.width(numProgressGeral + '%'); // .text(numProgressGeral + '%');
					progressBarAtual.width(numProgressAtual + '%'); // .text(numProgressAtual + '%');
				}
			}
		}, */
		success: function(data) {
			alert(data);
			console.log(data);
		},
		error: function(error){
			alert("Erro ao fazer a requisicação");
		}
		/*success: function (data) {
			console.log(data);
		}, error: function (data) {
			alert(data.responseText);
		}]*/
	});
</script>


































<script type="text/javascript">
	/*
	// Quando enviado o formulário
	var progressBar = $(".progress-bar");

function addProgress(percentual) {
  progressBar.width(percentual);
};

$.ajax({
	xhr: function() {
		var xhr = new window.XMLHttpRequest();
		xhr.upload.addEventListener("progress", function(evt) {
			if (evt.lengthComputable) {
				var percentComplete = evt.loaded / evt.total;
				addProgress((percentComplete * 100) + '%');
			} else {
				console.log("! evt.lengthComputable");
			}
		}, false);
		xhr.addEventListener("progress", function(evt) {
			if (evt.lengthComputable) {
				var percentComplete = evt.loaded / evt.total;
				addProgress((percentComplete * 100) + '%');
			} else {
				console.log("! evt.lengthComputable");
			}
		}, false);
		return xhr;
	},
	type: 'POST', //Or 'GET',
	// url: "http://posttestserver.com/post.php",
	url: "http://localhost:8088/Gerador/views/BackupProjetoAcao.php",
	data: {
		"importarBanco": true,
		"pasta": "GeradorBackUp",
		"projeto_id": 16
	},
	success: function(data) {
		alert(data);
		console.log(data);
	},
	error: function(error){
		alert("Erro ao fazer a requisicação");
	}
});*/
</script>

</body>
</html>